<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BT & EE Text Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bt-primary: #5514b4;
      --bt-primary-hover: #441090;
      --ee-primary: #009999;
      --ee-primary-hover: #007a7a;
      --secondary-gray: #6c757d;
      --secondary-gray-hover: #5a6268;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f4f7f9;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 700px;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .logo-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      height: 50px;
    }
    .logo-container svg {
      height: 100%;
      width: auto;
    }
    h1 {
      color: black;
      font-weight: 800;
      text-align: center;
      margin-top: 0;
      margin-bottom: 25px;
      font-size: 2.25rem;
    }
    label {
      display: block;
      font-weight: 600;
      color: #3b4d61;
      margin-bottom: 8px;
    }
    select, textarea, input[type="text"], input[type="date"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #dbe2e8;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }
    textarea {
      margin-top: 10px;
      height: 180px;
      resize: vertical;
      background-color: #f8f9fa;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    button {
      display: block;
      width: 100%;
      padding: 15px;
      margin-top: 0;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    #resetButton {
      background-color: var(--secondary-gray);
    }
    #resetButton:hover {
      background-color: var(--secondary-gray-hover);
    }
    .status {
      text-align: center;
      margin-top: 15px;
      color: #28a745;
      font-weight: 500;
      height: 20px;
    }
    .filter-selector {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
      border: 1px solid #dbe2e8;
      border-radius: 6px;
      overflow: hidden;
    }
    .filter-selector label, .filter-selector .button-like {
      flex: 1;
      text-align: center;
      padding: 12px;
      margin: 0;
      cursor: pointer;
      background-color: #f8f9fa;
      color: #555;
      transition: background-color 0.2s, color 0.2s;
      border: none;
      font-size: 16px;
      font-family: inherit;
    }
    .filter-selector input[type="radio"] {
      display: none;
    }
    .filter-selector input[type="radio"]:checked + label {
      color: white;
    }
    #charCounter {
      text-align: right;
      color: #555;
      font-size: 14px;
      margin-top: 5px;
      height: auto;
    }
    .feedback-text {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
      color: #6c757d;
    }
    .feedback-text a {
      text-decoration: none;
    }
    .feedback-text a:hover {
      text-decoration: underline;
    }
    .hidden {
      display: none;
    }
    .step-container {
      margin-bottom: 15px;
    }
    .custom-select-container {
      position: relative;
    }
    .scenario-dropdown {
      display: none;
      position: absolute;
      background-color: #f6f6f6;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 6px;
      z-index: 1;
      max-height: 250px;
      overflow-y: auto;
    }
    .scenario-dropdown.show {
      display: block;
    }
    .scenario-dropdown div {
      padding: 12px 16px;
      cursor: pointer;
      display: block;
    }
    .scenario-dropdown div:hover {
      background-color: #e9e9e9;
    }
    .scenario-dropdown .category-label {
      font-weight: bold;
      padding: 10px 16px 5px;
      color: #555;
      font-size: 14px;
      background-color: #f0f0f0;
    }
    .contextual-options {
      margin-top: 15px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 6px;
      border: 1px solid #dbe2e8;
    }
    .datetime-inputs {
      display: flex;
      gap: 10px;
    }
    .contextual-options button {
      margin-top: 10px;
      padding: 10px;
      font-size: 14px;
    }
    .theme-bt button#copyButton {
      background-color: var(--bt-primary);
    }
    .theme-bt button#copyButton:hover {
      background-color: var(--bt-primary-hover);
    }
    .theme-bt .contextual-options button {
      background-color: var(--bt-primary);
    }
    .theme-bt .contextual-options button:hover {
      background-color: var(--bt-primary-hover);
    }
    .theme-bt .filter-selector input[type="radio"]:checked + label {
      background-color: var(--bt-primary);
    }
    .theme-bt .step-summary {
      background-color: var(--bt-primary);
    }
    .theme-bt #logo-ee {
      visibility: hidden;
    }
    .theme-bt .feedback-text a {
      color: var(--bt-primary);
    }
    .theme-ee button#copyButton {
      background-color: var(--ee-primary);
    }
    .theme-ee button#copyButton:hover {
      background-color: var(--ee-primary-hover);
    }
    .theme-ee .contextual-options button {
      background-color: var(--ee-primary);
    }
    .theme-ee .contextual-options button:hover {
      background-color: var(--ee-primary-hover);
    }
    .theme-ee .filter-selector input[type="radio"]:checked + label {
      background-color: var(--ee-primary);
    }
    .theme-ee .step-summary {
      background-color: var(--ee-primary);
    }
    .theme-ee #logo-bt {
      visibility: hidden;
    }
    .theme-ee .feedback-text a {
      color: var(--ee-primary);
    }
  </style>
</head>
<body>
  <div id="appContainer" class="container">
    <div class="logo-container">
      <svg id="logo-bt" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="#5514b4">
        <circle cx="50" cy="50" r="48" stroke="#5514b4" stroke-width="4" fill="none"/>
        <text x="50" y="68" font-family="Arial, Helvetica, sans-serif" font-size="50" font-weight="bold" text-anchor="middle" fill="#5514b4">BT</text>
      </svg>
      <svg id="logo-ee" viewBox="0 0 80 40" xmlns="http://www.w3.org/2000/svg" fill="#009999">
        <text x="0" y="32" font-family="Arial, Helvetica, sans-serif" font-size="40" font-weight="bold" fill="#009999">EE</text>
      </svg>
    </div>
    <h1>Text Generator</h1>

    <!-- Step 1: Brand -->
    <div id="step-brand" class="step-container">
      <div id="summary-brand" class="step-summary hidden"></div>
      <div id="content-brand" class="step-content">
        <label>Select a brand:</label>
        <div class="filter-selector">
          <input type="radio" id="brandBT" name="brand" value="BT" />
          <label for="brandBT">BT</label>
          <input type="radio" id="brandEE" name="brand" value="EE" />
          <label for="brandEE">EE</label>
        </div>
      </div>
    </div>

    <!-- Step 2: Pre or Post -->
    <div id="step-type" class="step-container hidden">
      <div id="summary-type" class="step-summary hidden"></div>
      <div id="content-type" class="step-content">
        <label>What type of message are you sending?</label>
        <div class="filter-selector">
          <input type="radio" id="typePre" name="type" value="pre" />
          <label for="typePre">Pre-Text</label>
          <input type="radio" id="typePost" name="type" value="post" />
          <label for="typePost">Post-Text</label>
        </div>
      </div>
    </div>

    <!-- Step 3: Post‑Text Category -->
    <div id="step-category" class="step-container hidden">
      <div id="summary-category" class="step-summary hidden"></div>
      <div id="content-category" class="step-content">
        <label>Select a category:</label>
        <div class="filter-selector">
          <input type="radio" id="catAll" name="category" value="All" />
          <label for="catAll">All</label>
          <input type="radio" id="catDelays" name="category" value="Delays" />
          <label for="catDelays">Delays</label>
          <input type="radio" id="catSetUps" name="category" value="Set Up / General" />
          <label for="catSetUps">Set Up / General</label>
        </div>
      </div>
    </div>

    <!-- Step 4: Contact status (Post only) -->
    <div id="step-contact" class="step-container hidden">
      <div id="summary-contact" class="step-summary hidden"></div>
      <div id="content-contact" class="step-content">
        <label>Was contact made with the customer?</label>
        <div class="filter-selector">
          <input type="radio" id="contactYes" name="contactStatus" value="Yes" />
          <label for="contactYes">Contact Made</label>
          <input type="radio" id="contactNo" name="contactStatus" value="No" />
          <label for="contactNo">No Contact</label>
        </div>
      </div>
    </div>

    <!-- Final: Scenario & Message -->
    <div id="step-scenario" class="hidden">
      <label for="scenarioInput">Select a message template:</label>
      <div class="custom-select-container">
        <input type="text" id="scenarioInput" placeholder="Type or click to select..." />
        <div id="scenarioDropdown" class="scenario-dropdown"></div>
      </div>

      <div id="delay-options" class="contextual-options hidden">
        <label for="delayStartDate">Delay Identified On:</label>
        <input type="date" id="delayStartDate" />
      </div>

      <textarea id="messageOutput" placeholder="Your generated message will appear here..."></textarea>
      <div id="charCounter"></div>

      <div id="callback-options" class="contextual-options hidden">
        <label>Select Date and Time for Callback:</label>
        <div class="datetime-inputs">
          <input type="date" id="callbackDate" />
          <select id="callbackTime"></select>
        </div>
        <button id="insertDateTime">Insert Date & Time</button>
      </div>

      <div class="action-buttons">
        <button id="copyButton">Copy Message</button>
        <button id="resetButton">Reset</button>
      </div>
      <div id="statusMessage" class="status"></div>
    </div>

    <p class="feedback-text" style="font-style: italic; margin-top: 25px; margin-bottom: -15px;">
      This is just a rough draft and is subject to change.
    </p>
    <p class="feedback-text">
      Any feedback is welcome, please email me:
      <a href="mailto:calumbarnes@ee.co.uk">calumbarnes@ee.co.uk</a>
    </p>
  </div>

  <script>
    const scenarios = {
      pre: [
        { id: 'general_call', dropdownText: 'General Account Call', bt_template: `regarding your account. I'll try calling you in the next few minutes from an 0800 number.`, ee_template: `regarding your account. I'll try calling you in the next few minutes from an 0800 number.` },
        { id: 'order_issue', dropdownText: 'Issue with Order', bt_template: `we need to discuss an issue with your recent order. I'll be calling you shortly from an 0800 number to go over the details.`, ee_template: `we need to discuss an issue with your recent order. I'll be calling you shortly from an 0800 number to go over the details.` },
        { id: 'order_update', dropdownText: 'Order Progress Update', bt_template: `I'm calling to provide a progress update on your order. I'll try your number in the next few minutes from an 0800 number.`, ee_template: `I'm calling to provide a progress update on your order. I'll try your number in the next few minutes from an 0800 number.` },
        { id: 'engineer_booking', dropdownText: 'Book Engineer Visit', bt_template: `I'm calling to book in your engineer appointment to get your new service installed. I'll call you in the next few minutes from an 0800 number.`, ee_template: `I'm calling to book in your engineer appointment to get your new service installed. I'll call you in the next few minutes from an 0800 number.` },
        { id: 'engineer_reminder', dropdownText: 'Engineer Appointment Reminder', bt_template: `I'm calling with a quick reminder about your scheduled engineer visit. I'll be calling shortly from an 0800 number to confirm the details and answer any questions.`, ee_template: `I'm calling with a quick reminder about your scheduled engineer visit. I'll be calling shortly from an 0800 number to confirm the details and answer any questions.` },
        { id: 'query_follow_up', dropdownText: 'Follow Up on a Query', bt_template: `I'm following up on your recent query. I will be calling you shortly from an 0800 number to discuss this further.`, ee_template: `I'm following up on your recent query. I will be calling you shortly from an 0800 number to discuss this further.` },
        { id: 'complaint_follow_up', dropdownText: 'Follow Up on a Complaint', bt_template: `regarding your recent complaint. I will be calling you in the next few minutes from an 0800 number to discuss how we can resolve this for you.`, ee_template: `regarding your recent complaint. I will be calling you in the next few minutes from an 0800 number to discuss how we can resolve this for you.` }
      ],
      post: [
        // (All your previous post scenarios — delays etc.)
        { id: 'ducting_issue', category: 'Delays', dropdownText: 'External Ducting Issue (12 Weeks)', delayDays: 60, bt_template: `We're sorry to let you know that there are some issues with the external ducting for your BT service, but please be assured we've already tasked our contractors with sorting it out. It's quite a complex job, so we're estimating it may take up to 12 weeks to fully resolve.\n\nHowever, we promise to keep you updated along the way and aim to provide you with an update no later than 9 PM on the {date}.\n\nYou can find a helpful booklet here: https://care.bt.com/next_steps`, ee_template: `We've hit a snag with some external ducting work for your new EE Full Fibre service. It's a tricky issue that our network partners are working to resolve. We expect this to be sorted within 12 weeks.\n\nYour next update will be scheduled for {date}. We're sorry for the delay and appreciate your patience.\n\nAs an EE customer, you can use BT/EE WIFI hotspots for free while you wait. Find out more here: https://ee-wifi.ee.co.uk/public/ee/help/index.htm` },
        // … (insert all your other delay, setup/general scenarios here exactly as before) …
        // Now our updated complaint_logged
        {
          id: 'complaint_logged',
          category: 'Set Up / General',
          dropdownText: 'Complaint Logged / Callback',
          delayDays: 0,
          requiresCallback: true,
          bt_template: `Complaint has been logged and our team will process it further.`,
          ee_template: `Complaint has been logged and our team will process it further.`,
          bt_template_nocontact: `Sorry I missed you today. I was phoning about your recent complaint and will call you back on `,
          ee_template_nocontact: `Sorry I missed you today. I was phoning about your recent complaint and will call you back on `
        },
        // Also keep the call_back scenario (for general callback) if you had it
        {
          id: 'call_back',
          category: 'Set Up / General',
          dropdownText: 'Arrange/Book a Call Back',
          delayDays: 0,
          requiresCallback: true,
          bt_template: `Hi there. I am really sorry for the experience you have had up to now. I want to assure you I will be calling back on `,
          ee_template: `Hi there. I'm sorry for the experience you've had so far. I want to assure you I will be calling you back on `,
          bt_template_nocontact: `Sorry I missed you. If you'd still like to speak to us, you can book a call back at a time that suits you here: https://www.bt.com/help/contact-us/callback`,
          ee_template_nocontact: `Sorry I missed you. If you'd still like to speak to us, you can book a call back at a time that suits you here: https://ee.co.uk/help/contact-ee/callback`
        }
      ]
    };

    const selections = {
      type: null,
      brand: null,
      category: null,
      contact: null,
      scenarioId: null
    };

    const appContainer = document.getElementById('appContainer');
    const stepElements = {
      brand: document.getElementById('step-brand'),
      type: document.getElementById('step-type'),
      category: document.getElementById('step-category'),
      contact: document.getElementById('step-contact'),
      scenario: document.getElementById('step-scenario')
    };
    const messageOutput = document.getElementById('messageOutput');
    const scenarioInput = document.getElementById('scenarioInput');
    const scenarioDropdown = document.getElementById('scenarioDropdown');
    const charCounter = document.getElementById('charCounter');
    const delayOptions = document.getElementById('delay-options');
    const callbackOptions = document.getElementById('callback-options');
    const copyButton = document.getElementById('copyButton');
    const resetButton = document.getElementById('resetButton');
    const statusMessage = document.getElementById('statusMessage');
    const delayStartDateInput = document.getElementById('delayStartDate');
    const callbackDateInput = document.getElementById('callbackDate');
    const callbackTimeInput = document.getElementById('callbackTime');
    const insertDateTimeButton = document.getElementById('insertDateTime');

    function updateUI() {
      const { type, brand, category, contact } = selections;

      appContainer.classList.toggle('theme-bt', brand === 'BT');
      appContainer.classList.toggle('theme-ee', brand === 'EE');

      stepElements.brand.classList.remove('hidden');
      stepElements.type.classList.toggle('hidden', !brand);
      stepElements.category.classList.toggle('hidden', type !== 'post');
      stepElements.contact.classList.toggle('hidden', !(type === 'post' && category));

      const showScenario = (type === 'pre' && !!brand) || (type === 'post' && !!contact);
      stepElements.scenario.classList.toggle('hidden', !showScenario);

      if (!showScenario) {
        clearScenarioSelection();
      } else {
        populateDropdown();
        scenarioInput.focus();
      }
    }

    function populateDropdown() {
      const currentScenarios = scenarios[selections.type] || [];
      const searchTerm = scenarioInput.value.toLowerCase();

      const filtered = currentScenarios.filter(s => {
        const categoryMatch = selections.type === 'pre' ||
                              selections.category === 'All' ||
                              s.category === selections.category;
        const searchMatch = s.dropdownText.toLowerCase().includes(searchTerm);
        return categoryMatch && searchMatch;
      });

      filtered.sort((a, b) => a.dropdownText.localeCompare(b.dropdownText));

      scenarioDropdown.innerHTML = '';

      if (selections.type === 'post' && selections.category === 'All') {
        const grouped = filtered.reduce((acc, s) => {
          (acc[s.category] = acc[s.category] || []).push(s);
          return acc;
        }, {});
        Object.keys(grouped).sort().forEach(cat => {
          const optgroup = document.createElement('div');
          optgroup.className = 'category-label';
          optgroup.textContent = cat;
          scenarioDropdown.appendChild(optgroup);
          grouped[cat].forEach(addScenarioItem);
        });
      } else {
        filtered.forEach(addScenarioItem);
      }

      scenarioDropdown.classList.toggle('show', filtered.length > 0);
    }

    function addScenarioItem(s) {
      const item = document.createElement('div');
      item.textContent = s.dropdownText;
      item.dataset.id = s.id;
      item.addEventListener('click', () => {
        scenarioInput.value = s.dropdownText;
        selections.scenarioId = s.id;
        scenarioDropdown.classList.remove('show');
        generateMessage();
      });
      scenarioDropdown.appendChild(item);
    }

    function generateMessage() {
      if (!selections.type || !selections.scenarioId) {
        messageOutput.value = '';
        updateCharCounter();
        return;
      }

      const selectedScenario = scenarios[selections.type].find(s => s.id === selections.scenarioId);
      if (!selectedScenario) {
        messageOutput.value = '';
        updateCharCounter();
        return;
      }

      // Base template depending on brand
      let message = (selections.brand === 'BT')
        ? selectedScenario.bt_template
        : selectedScenario.ee_template;

      if (selections.type === 'post') {
        // For delay scenarios that use {date}
        if (selectedScenario.delayDays > 0 && message.includes('{date}')) {
          const startDate = delayStartDateInput.value;
          const useWorking = (selectedScenario.isWorkingDays !== false);
          const calcDate = calculateDate(selectedScenario.delayDays, startDate, useWorking);
          message = message.replace(/{date}/g, formatDate(calcDate));
        }

        const hasGreeting = message.toLowerCase().startsWith('hi');

        if (selections.scenarioId === 'complaint_logged') {
          // Special logic for complaint_logged
          if (selections.contact === 'Yes') {
            // Contact made: simple acknowledgement
            message = (selections.brand === 'BT')
              ? selectedScenario.bt_template
              : selectedScenario.ee_template;
          } else {
            // No contact: fallback to nocontact + callback
            if (selectedScenario.bt_template_nocontact && selectedScenario.ee_template_nocontact) {
              message = (selections.brand === 'BT')
                ? selectedScenario.bt_template_nocontact
                : selectedScenario.ee_template_nocontact;
            } else {
              const unc = message.charAt(0).toLowerCase() + message.slice(1);
              message = `Sorry I missed you today. ${unc}`;
            }
          }
        } else {
          // Default logic for other post scenarios
          if (selections.contact === 'No') {
            if (selectedScenario.bt_template_nocontact && selectedScenario.ee_template_nocontact) {
              message = (selections.brand === 'BT')
                ? selectedScenario.bt_template_nocontact
                : selectedScenario.ee_template_nocontact;
            } else {
              const unc = message.charAt(0).toLowerCase() + message.slice(1);
              message = `Sorry I couldn't reach you. ${unc}`;
            }
          } else if (selections.contact === 'Yes' && !hasGreeting) {
            const unc = message.charAt(0).toLowerCase() + message.slice(1);
            message = `It was great to speak to you today. ${unc}`;
          }
        }
      }

      messageOutput.value = message;

      // Show callback UI if scenario requires it
      const needsCallback = !!(selectedScenario.requiresCallback);
      callbackOptions.classList.toggle('hidden', !needsCallback);

      // Show delay date UI only for delay category
      delayOptions.classList.toggle('hidden',
        !(selectedScenario && selectedScenario.category === 'Delays'));

      updateCharCounter();
    }

    function clearScenarioSelection() {
      scenarioInput.value = '';
      selections.scenarioId = null;
      messageOutput.value = '';
      updateCharCounter();
      delayOptions.classList.add('hidden');
      callbackOptions.classList.add('hidden');
    }

    function resetApp() {
      selections.type = null;
      selections.brand = null;
      selections.category = null;
      selections.contact = null;
      selections.scenarioId = null;

      document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);

      clearScenarioSelection();

      const today = new Date().toISOString().split('T')[0];
      delayStartDateInput.value = today;
      callbackDateInput.value = today;
      populateTimeSlots(today);

      updateUI();
    }

    function updateCharCounter() {
      const len = messageOutput.value.length;
      charCounter.textContent = len > 0 ? `${len} characters (${Math.ceil(len / 160)} SMS)` : '';
    }

    function formatDate(date) {
      const d = String(date.getDate()).padStart(2, '0');
      const m = String(date.getMonth() + 1).padStart(2, '0');
      return `${d}/${m}/${date.getFullYear()}`;
    }

    function calculateDate(daysToAdd, startDateString, useWorkingDays = true) {
      let currentDate = startDateString
        ? new Date(startDateString + 'T00:00:00')
        : new Date();

      if (useWorkingDays) {
        let added = 0;
        while (added < daysToAdd) {
          currentDate.setDate(currentDate.getDate() + 1);
          const dow = currentDate.getDay();
          if (dow !== 0 && dow !== 6) {
            added++;
          }
        }
      } else {
        currentDate.setDate(currentDate.getDate() + daysToAdd);
      }
      return currentDate;
    }

    function populateTimeSlots(dateString) {
      callbackTimeInput.innerHTML = '';
      const d = new Date(dateString + 'T00:00:00');
      const day = d.getDay();
      const startHour = (day === 0 ? 9 : 8);

      for (let h = startHour; h < 20; h++) {
        for (let m = 0; m < 60; m += 15) {
          const hh = String(h).padStart(2, '0');
          const mm = String(m).padStart(2, '0');
          const opt = document.createElement('option');
          opt.value = opt.textContent = `${hh}:${mm}`;
          callbackTimeInput.appendChild(opt);
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];
      callbackDateInput.min = today;
      callbackDateInput.value = today;
      delayStartDateInput.value = today;
      populateTimeSlots(today);
      updateUI();
    });

    ['brand', 'type', 'category', 'contactStatus'].forEach(name => {
      document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
        radio.addEventListener('change', e => {
          const key = name === 'contactStatus' ? 'contact' : name;
          selections[key] = e.target.value;

          if (key === 'brand' || key === 'contact') {
            if (selections.scenarioId) {
              generateMessage();
            }
          } else {
            clearScenarioSelection();
          }

          updateUI();
        });
      });
    });

    scenarioInput.addEventListener('input', populateDropdown);
    scenarioInput.addEventListener('click', () => {
      if (scenarioInput.value !== '') {
        clearScenarioSelection();
      }
      populateDropdown();
      scenarioInput.focus();
    });

    document.addEventListener('click', e => {
      if (!appContainer.contains(e.target)) {
        scenarioDropdown.classList.remove('show');
      }
    });

    delayStartDateInput.addEventListener('change', generateMessage);
    callbackDateInput.addEventListener('change', e => populateTimeSlots(e.target.value));
    insertDateTimeButton.addEventListener('click', () => {
      const date = callbackDateInput.value;
      const time = callbackTimeInput.value;
      if (date && time) {
        const dObj = new Date(date + 'T00:00:00');
        const fmt = dObj.toLocaleDateString('en-GB', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
        messageOutput.value += `${fmt} at ${time}`;
        updateCharCounter();
      }
    });

    copyButton.addEventListener('click', () => {
      if (messageOutput.value) {
        try {
          messageOutput.select();
          messageOutput.setSelectionRange(0, 99999);
          if (document.execCommand('copy')) {
            statusMessage.textContent = 'Message copied to clipboard!';
          } else {
            statusMessage.textContent = 'Failed to copy!';
          }
          window.getSelection().removeAllRanges();
        } catch (err) {
          statusMessage.textContent = 'Failed to copy!';
        } finally {
          setTimeout(() => { statusMessage.textContent = ''; }, 2000);
        }
      }
    });

    resetButton.addEventListener('click', resetApp);
    messageOutput.addEventListener('input', updateCharCounter);

  </script>
</body>
</html>
